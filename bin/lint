#!/bin/bash

# Lint and auto-fix Ruby and Rust code
cd "$(dirname "$0")/.."

echo "üîç Linting and fixing code..."
echo "============================="

# Ruby linting with Rubocop
if command -v bundle &> /dev/null; then
    echo ""
    echo "üíé Ruby linting with Rubocop..."
    bundle exec rubocop -A --color
    RUBY_EXIT=$?
else
    echo "‚ö†Ô∏è  Skipping Ruby lint (bundler not installed)"
    RUBY_EXIT=0
fi

# Rust linting with clippy and formatting
if command -v cargo &> /dev/null; then
    echo ""
    echo "ü¶Ä Rust formatting with rustfmt..."
    cargo fmt
    
    echo ""
    echo "ü¶Ä Rust linting with clippy..."
    cargo clippy --fix --allow-dirty --allow-staged -- -W clippy::all
    RUST_EXIT=$?
else
    echo "‚ö†Ô∏è  Skipping Rust lint (cargo not installed)"
    RUST_EXIT=0
fi

echo ""
if [ $RUBY_EXIT -eq 0 ] && [ $RUST_EXIT -eq 0 ]; then
    echo "‚úÖ All linting complete!"
    exit 0
else
    echo "‚ö†Ô∏è  Some linting issues remain"
    exit 1
fi